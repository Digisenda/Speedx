<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>SPEEDX - Control de Trabajo</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#2563EB" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="SPEEDX" />

  <!-- Manifest (embebido como data URL; start_url relativo para que funcione en Pages) -->
  <link rel="manifest" href='data:application/json;charset=utf-8,{"name":"SPEEDX Control de Trabajo","short_name":"SPEEDX","description":"Dashboard de control de entregas SPEEDX","start_url":".","display":"standalone","background_color":"#ffffff","theme_color":"#2563EB","icons":[{"src":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTkyIDE5MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCBmaWxsPSIjMjU2M0VCIiB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIvPjx0ZXh0IHg9Ijk2IiB5PSIxMDAiIGZpbGw9IiNGRkYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iNjBweCI+8J+RrzwvdGV4dD48L3N2Zz4=","sizes":"192x192","type":"image/svg+xml"}]}' />

  <!-- Icono (emoji fallback) -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üöö</text></svg>'>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh; color:#333; -webkit-font-smoothing:antialiased;
      -webkit-tap-highlight-color:transparent; user-select:none;
    }
    .app-container { max-width:100vw; padding:10px; min-height:100vh; }
    .header {
      background:rgba(255,255,255,0.95); backdrop-filter:blur(10px);
      border-radius:20px; padding:20px; margin-bottom:15px; text-align:center;
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .header h1 { color:#2563EB; font-size:1.8rem; font-weight:800; margin-bottom:5px; }
    .header p { color:#6B7280; font-size:.9rem; }
    .kpi-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px; }
    .kpi-card {
      --accent-color:#3B82F6;
      background:rgba(255,255,255,0.95); backdrop-filter:blur(10px);
      border-radius:16px; padding:20px 15px; text-align:center; position:relative; overflow:hidden;
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .kpi-card.packages { --accent-color:#3B82F6; }
    .kpi-card.earnings { --accent-color:#10B981; }
    .kpi-card.deliveries { --accent-color:#8B5CF6; }
    .kpi-card.efficiency { --accent-color:#F59E0B; }
    .kpi-card::before { content:""; position:absolute; top:0; left:0; right:0; height:4px; background:var(--accent-color); }
    .kpi-icon { font-size:2.5rem; margin-bottom:8px; display:block; }
    .kpi-value { font-size:1.8rem; font-weight:700; color:#1F2937; margin-bottom:4px; }
    .kpi-label { font-size:.8rem; color:#6B7280; margin-bottom:4px; }
    .kpi-subtitle { font-size:.7rem; color:#10B981; font-weight:600; }

    .chart-container {
      background:rgba(255,255,255,0.95); backdrop-filter:blur(10px);
      border-radius:16px; padding:20px 15px; margin-bottom:20px;
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .chart-title { font-size:1.1rem; font-weight:600; color:#1F2937; margin-bottom:15px; text-align:center; }
    .simple-chart { height:150px; display:flex; align-items:flex-end; justify-content:space-around; padding:10px; }
    .chart-bar { border-radius:4px 4px 0 0; min-width:30px; position:relative; margin:0 2px; }
    .chart-bar.delivered { background:linear-gradient(to top,#10B981,#34D399); }
    .chart-bar.not-delivered { background:linear-gradient(to top,#EF4444,#F87171); }
    .chart-label {
      position:absolute; bottom:-25px; left:50%; transform:translateX(-50%);
      font-size:.7rem; color:#6B7280; white-space:nowrap;
    }

    .actions-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px; }
    .action-btn {
      background:rgba(255,255,255,0.95); backdrop-filter:blur(10px);
      border:none; border-radius:16px; padding:20px; display:flex; flex-direction:column;
      align-items:center; gap:8px; box-shadow:0 8px 32px rgba(0,0,0,0.1);
      cursor:pointer; transition:.3s; text-decoration:none; color:inherit;
    }
    .action-btn:active { transform:scale(0.95); box-shadow:0 4px 16px rgba(0,0,0,0.1); }
    .action-icon { font-size:2rem; }
    .action-text { font-size:.9rem; font-weight:600; color:#1F2937; }

    .data-table {
      background:rgba(255,255,255,0.95); backdrop-filter:blur(10px);
      border-radius:16px; padding:15px; box-shadow:0 8px 32px rgba(0,0,0,0.1); margin-bottom:20px;
    }
    .table-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
    .table-title { font-size:1.1rem; font-weight:600; color:#1F2937; }

    .record-item { background:#F9FAFB; border-radius:12px; padding:15px; margin-bottom:10px; border-left:4px solid #3B82F6; }
    .record-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .record-date { font-weight:600; color:#1F2937; }
    .record-earnings { font-weight:700; color:#10B981; }
    .record-details { display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:.8rem; color:#6B7280; }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; display:none; align-items:center; justify-content:center; padding:20px; }
    .modal.open { display:flex; }
    .modal-content { background:#fff; border-radius:16px; padding:20px; width:100%; max-width:400px; max-height:80vh; overflow-y:auto; }
    .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .modal-title { font-size:1.2rem; font-weight:600; color:#1F2937; }
    .close-btn { background:none; border:none; font-size:1.5rem; cursor:pointer; color:#6B7280; }

    .form-grid { display:grid; gap:15px; }
    .form-group { display:flex; flex-direction:column; gap:5px; }
    .form-label { font-size:.9rem; font-weight:500; color:#374151; }
    .form-input { border:2px solid #E5E7EB; border-radius:8px; padding:12px; font-size:1rem; transition:border-color .3s; }
    .form-input:focus { outline:none; border-color:#3B82F6; }

    .form-actions { display:flex; gap:10px; margin-top:20px; }
    .btn { border:none; border-radius:8px; padding:12px 20px; font-size:1rem; font-weight:600; cursor:pointer; transition:.3s; flex:1; }
    .btn-primary { background:#3B82F6; color:#fff; }
    .btn-primary:active { background:#2563EB; }
    .btn-secondary { background:#E5E7EB; color:#374151; }
    .btn-secondary:active { background:#D1D5DB; }

    .hidden { display:none !important; }

    .stats-row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; margin-top:20px; }
    .stat-item { background:rgba(255,255,255,0.95); backdrop-filter:blur(10px); border-radius:12px; padding:15px; text-align:center; box-shadow:0 4px 16px rgba(0,0,0,0.1); }
    .stat-value { font-size:1.2rem; font-weight:700; color:#1F2937; }
    .stat-label { font-size:.7rem; color:#6B7280; margin-top:4px; }

    .install-banner {
      background:linear-gradient(90deg,#3B82F6,#1D4ED8); color:#fff; padding:15px; border-radius:12px; margin-bottom:20px; text-align:center; position:relative; overflow:hidden;
    }
    .install-banner::before { content:'üì±'; position:absolute; right:-10px; top:50%; transform:translateY(-50%); font-size:3rem; opacity:.3; }
    .install-text { font-weight:600; margin-bottom:8px; }
    .install-description { font-size:.8rem; opacity:.9; }

    /* Responsive */
    @media (max-width:360px){
      .kpi-grid { grid-template-columns:1fr; }
      .actions-grid { grid-template-columns:1fr; }
      .stats-row { grid-template-columns:1fr 1fr; }
    }
    /* Dark mode */
    @media (prefers-color-scheme:dark){
      body { background:linear-gradient(135deg,#1E293B 0%,#0F172A 100%); color:#F1F5F9; }
      .kpi-card,.chart-container,.action-btn,.data-table,.stat-item,.modal-content { background:rgba(30,41,59,0.95); color:#F1F5F9; }
      .kpi-value,.modal-title,.table-title,.record-date { color:#F1F5F9; }
      .kpi-label,.kpi-subtitle,.record-details { color:#CBD5E1; }
    }
  </style>
</head>
<body>
  <div class="app-container" id="app">
    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
      <div class="install-text">¬°Instala SPEEDX en tu m√≥vil!</div>
      <div class="install-description">Acceso r√°pido desde tu pantalla de inicio</div>
    </div>

    <!-- Header -->
    <div class="header">
      <h1>üöö SPEEDX</h1>
      <p>Control de Trabajo Mobile</p>
    </div>

    <!-- KPIs Grid -->
    <div class="kpi-grid">
      <div class="kpi-card packages">
        <span class="kpi-icon">üì¶</span>
        <div class="kpi-value" id="totalPackages">22</div>
        <div class="kpi-label">Paquetes</div>
        <div class="kpi-subtitle" id="deliveryRate">95.5%</div>
      </div>

      <div class="kpi-card earnings">
        <span class="kpi-icon">üí∞</span>
        <div class="kpi-value" id="totalEarnings">$20.07</div>
        <div class="kpi-label">Ganancias</div>
        <div class="kpi-subtitle" id="margin">42.1%</div>
      </div>

      <div class="kpi-card deliveries">
        <span class="kpi-icon">‚úÖ</span>
        <div class="kpi-value" id="delivered">21</div>
        <div class="kpi-label">Entregados</div>
        <div class="kpi-subtitle">de 22 total</div>
      </div>

      <div class="kpi-card efficiency">
        <span class="kpi-icon">üõ£Ô∏è</span>
        <div class="kpi-value" id="totalMiles">160</div>
        <div class="kpi-label">Millas</div>
        <div class="kpi-subtitle" id="efficiency">7.62 paq/100mi</div>
      </div>
    </div>

    <!-- Simple Chart -->
    <div class="chart-container">
      <div class="chart-title">üìä Rendimiento de Entregas</div>
      <div class="simple-chart">
        <div class="chart-bar delivered" id="deliveredBar" style="height:90%">
          <div class="chart-label">Entregados</div>
        </div>
        <div class="chart-bar not-delivered" id="notDeliveredBar" style="height:10%">
          <div class="chart-label">No Entregados</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="actions-grid">
      <button class="action-btn" onclick="openModal('addModal')">
        <span class="action-icon">‚ûï</span>
        <span class="action-text">Agregar D√≠a</span>
      </button>

      <button class="action-btn" onclick="openModal('statsModal')">
        <span class="action-icon">üìà</span>
        <span class="action-text">Estad√≠sticas</span>
      </button>
    </div>

    <!-- Recent Records -->
    <div class="data-table">
      <div class="table-header">
        <div class="table-title">üìã Registros Recientes</div>
      </div>
      <div id="recordsList"><!-- Records here --></div>
    </div>

    <!-- Additional Stats -->
    <div class="stats-row">
      <div class="stat-item">
        <div class="stat-value" id="avgPerMile">7.62</div>
        <div class="stat-label">Paq/100mi</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="fuelEfficiency">2.44</div>
        <div class="stat-label">Paq/Gal√≥n</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="costPerPackage">$1.09</div>
        <div class="stat-label">Costo/Paq</div>
      </div>
    </div>
  </div>

  <!-- Add Record Modal -->
  <div class="modal hidden" id="addModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚ûï Nuevo Registro</div>
        <button class="close-btn" onclick="closeModal('addModal')">&times;</button>
      </div>
      <form id="addForm" class="form-grid">
        <div class="form-group">
          <label class="form-label">Fecha</label>
          <input type="date" class="form-input" id="fecha" required>
        </div>
        <div class="form-group">
          <label class="form-label">Total Paquetes</label>
          <input type="number" class="form-input" id="totalPaq" required>
        </div>
        <div class="form-group">
          <label class="form-label">Precio por Paquete ($)</label>
          <input type="number" step="0.01" class="form-input" id="precio" required>
        </div>
        <div class="form-group">
          <label class="form-label">Zona</label>
          <input type="text" class="form-input" id="zona" placeholder="Centro, Norte, etc.">
        </div>
        <div class="form-group">
          <label class="form-label">Entregados</label>
          <input type="number" class="form-input" id="entregados" required>
        </div>
        <div class="form-group">
          <label class="form-label">No Entregados</label>
          <input type="number" class="form-input" id="noEntregados" value="0">
        </div>
        <div class="form-group">
          <label class="form-label">Millas Totales</label>
          <input type="number" class="form-input" id="millas" required>
        </div>
        <div class="form-group">
          <label class="form-label">Combustible (Galones)</label>
          <input type="number" step="0.01" class="form-input" id="combustible" required>
        </div>
        <div class="form-group">
          <label class="form-label">Costos Totales ($)</label>
          <input type="number" step="0.01" class="form-input" id="costos" required>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">üíæ Guardar</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">‚ùå Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Stats Modal -->
  <div class="modal hidden" id="statsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">üìà Estad√≠sticas Detalladas</div>
        <button class="close-btn" onclick="closeModal('statsModal')">&times;</button>
      </div>
      <div id="detailedStats"><!-- content --></div>
    </div>
  </div>

  <script>
    /* App Data Storage (seed) */
    let appData = {
      records: [{
        id: 1,
        fecha: '2025-08-25',
        totalPaq: 22,
        precio: 2.67,
        zona: 'Centro',
        entregados: 21,
        noEntregados: 1,
        horaInicio: '10:00',
        horaFinal: '17:00',
        millas: 160,
        combustible: 9,
        costos: 24.03,
        promedioMilla: 7.62,
        promedioCombustible: 0.43,
        gananciaReal: 20.07
      }]
    };

    function loadData() {
      const saved = localStorage.getItem('speedxData');
      if (saved) appData = JSON.parse(saved);
      updateUI();
    }
    function saveData() {
      localStorage.setItem('speedxData', JSON.stringify(appData));
    }

    function calculateMetrics(record) {
      const totalPaq = Number(record.totalPaq || 0);
      const millas = Number(record.millas || 0);
      const combustible = Number(record.combustible || 0);
      const precio = Number(record.precio || 0);
      const costos = Number(record.costos || 0);

      return {
        ...record,
        promedioMilla: millas ? (totalPaq / millas * 100).toFixed(2) : "0.00",
        promedioCombustible: combustible ? (totalPaq / combustible).toFixed(2) : "0.00",
        gananciaReal: (precio * totalPaq - costos).toFixed(2)
      };
    }

    function updateUI() {
      const totals = appData.records.reduce((acc, r) => {
        acc.totalPackages += Number(r.totalPaq || 0);
        acc.totalDelivered += Number(r.entregados || 0);
        acc.totalNotDelivered += Number(r.noEntregados || 0);
        acc.totalMiles += Number(r.millas || 0);
        acc.totalEarnings += Number(r.gananciaReal || 0);
        acc.totalCosts += Number(r.costos || 0);
        acc.totalRevenue += Number(r.precio || 0) * Number(r.totalPaq || 0);
        return acc;
      }, { totalPackages:0, totalDelivered:0, totalNotDelivered:0, totalMiles:0, totalEarnings:0, totalCosts:0, totalRevenue:0 });

      document.getElementById('totalPackages').textContent = totals.totalPackages;
      document.getElementById('totalEarnings').textContent = '$' + totals.totalEarnings.toFixed(2);
      document.getElementById('delivered').textContent = totals.totalDelivered;
      document.getElementById('totalMiles').textContent = totals.totalMiles;

      const deliveryRate = totals.totalPackages ? (totals.totalDelivered / totals.totalPackages * 100).toFixed(1) : '0.0';
      const margin = totals.totalRevenue ? (totals.totalEarnings / totals.totalRevenue * 100).toFixed(1) : '0.0';
      const efficiency = totals.totalMiles ? (totals.totalPackages / totals.totalMiles * 100).toFixed(2) : '0.00';

      document.getElementById('deliveryRate').textContent = deliveryRate + '%';
      document.getElementById('margin').textContent = margin + '%';
      document.getElementById('efficiency').textContent = efficiency + ' paq/100mi';

      const deliveredPercent = totals.totalPackages ? (totals.totalDelivered / totals.totalPackages * 100) : 0;
      const notDeliveredPercent = 100 - deliveredPercent;
      document.getElementById('deliveredBar').style.height = Math.max(deliveredPercent, 5) + '%';
      document.getElementById('notDeliveredBar').style.height = Math.max(notDeliveredPercent, 5) + '%';

      document.getElementById('avgPerMile').textContent = efficiency;
      const fuelSum = appData.records.reduce((s, r) => s + Number(r.combustible || 0), 0);
      document.getElementById('fuelEfficiency').textContent = fuelSum ? (totals.totalPackages / fuelSum).toFixed(2) : '0.00';
      document.getElementById('costPerPackage').textContent = '$' + (totals.totalPackages ? (totals.totalCosts / totals.totalPackages).toFixed(2) : '0.00');

      updateRecordsList();
    }

    function updateRecordsList() {
      const container = document.getElementById('recordsList');
      const recent = appData.records.slice(-5).reverse();
      container.innerHTML = recent.map(record => `
        <div class="record-item">
          <div class="record-header">
            <div class="record-date">${formatDate(record.fecha)}</div>
            <div class="record-earnings">$${record.gananciaReal}</div>
          </div>
          <div class="record-details">
            <div>üì¶ ${record.totalPaq} paquetes</div>
            <div>‚úÖ ${record.entregados} entregados</div>
            <div>üõ£Ô∏è ${record.millas} millas</div>
            <div>üìç ${record.zona || 'NA'}</div>
          </div>
        </div>
      `).join('');
    }

    function formatDate(s) {
      const d = new Date(s);
      return d.toLocaleDateString('es-ES', { day:'2-digit', month:'2-digit' });
    }

    function openModal(id) {
      document.getElementById(id).classList.remove('hidden');
      document.getElementById(id).classList.add('open');
      if (id === 'addModal') document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
      if (id === 'statsModal') updateDetailedStats();
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      el.classList.add('hidden'); el.classList.remove('open');
      if (id === 'addModal') document.getElementById('addForm').reset();
    }

    function updateDetailedStats() {
      const t = appData.records.reduce((a, r) => {
        a.totalPackages += Number(r.totalPaq || 0);
        a.totalDelivered += Number(r.entregados || 0);
        a.totalMiles += Number(r.millas || 0);
        a.totalEarnings += Number(r.gananciaReal || 0);
        a.totalCosts += Number(r.costos || 0);
        a.totalFuel += Number(r.combustible || 0);
        return a;
      }, { totalPackages:0, totalDelivered:0, totalMiles:0, totalEarnings:0, totalCosts:0, totalFuel:0 });

      const avgEarningsPerDay = appData.records.length ? (t.totalEarnings / appData.records.length).toFixed(2) : '0.00';
      const avgPackagesPerDay = appData.records.length ? (t.totalPackages / appData.records.length).toFixed(1) : '0.0';
      const milesPerGallon = t.totalFuel ? (t.totalMiles / t.totalFuel).toFixed(2) : '0.00';

      document.getElementById('detailedStats').innerHTML = `
        <div class="stats-row">
          <div class="stat-item"><div class="stat-value">${avgEarningsPerDay}</div><div class="stat-label">$ / d√≠a promedio</div></div>
          <div class="stat-item"><div class="stat-value">${avgPackagesPerDay}</div><div class="stat-label">paq / d√≠a promedio</div></div>
          <div class="stat-item"><div class="stat-value">${milesPerGallon}</div><div class="stat-label">millas / gal√≥n</div></div>
        </div>
        <div style="margin-top:20px; padding:15px; background:#F3F4F6; border-radius:8px;">
          <h4 style="margin-bottom:10px; color:#374151;">üìä Resumen Total</h4>
          <div style="font-size:.9rem; color:#6B7280; line-height:1.5;">
            ‚Ä¢ Total d√≠as trabajados ${appData.records.length}<br>
            ‚Ä¢ Total paquetes manejados ${t.totalPackages}<br>
            ‚Ä¢ Tasa de entrega ${(t.totalPackages ? (t.totalDelivered / t.totalPackages * 100).toFixed(1) : '0.0')}%<br>
            ‚Ä¢ Millas totales recorridas ${t.totalMiles}<br>
            ‚Ä¢ Ganancias totales $${t.totalEarnings.toFixed(2)}<br>
            ‚Ä¢ ROI promedio ${(t.totalCosts ? ((t.totalEarnings / t.totalCosts) * 100).toFixed(1) : '0.0')}%
          </div>
        </div>
      `;
    }

    document.getElementById('addForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const newRecord = {
        id: Date.now(),
        fecha: document.getElementById('fecha').value,
        totalPaq: parseInt(document.getElementById('totalPaq').value),
        precio: parseFloat(document.getElementById('precio').value),
        zona: document.getElementById('zona').value,
        entregados: parseInt(document.getElementById('entregados').value),
        noEntregados: parseInt(document.getElementById('noEntregados').value),
        millas: parseInt(document.getElementById('millas').value),
        combustible: parseFloat(document.getElementById('combustible').value),
        costos: parseFloat(document.getElementById('costos').value)
      };
      const recordWithMetrics = calculateMetrics(newRecord);
      appData.records.push(recordWithMetrics);
      saveData();
      updateUI();
      closeModal('addModal');
      showNotification('‚úÖ Registro guardado correctamente');
    });

    function showNotification(message) {
      const n = document.createElement('div');
      n.style.cssText = `
        position:fixed; top:20px; left:50%; transform:translateX(-50%);
        background:#10B981; color:white; padding:12px 20px; border-radius:8px; font-weight:600; z-index:2000;
      `;
      n.textContent = message; document.body.appendChild(n);
      setTimeout(()=>n.remove(),3000);
    }

    /* PWA Installation */
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e;
      document.getElementById('installBanner').style.display = 'block';
    });
    document.getElementById('installBanner').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        document.getElementById('installBanner').style.display = 'none';
      }
    });

    /* Service Worker Registration */
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE_NAME = 'speedx-v1';
        const urlsToCache = ['./'];
        self.addEventListener('install', event => {
          event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache)));
        });
        self.addEventListener('fetch', event => {
          event.respondWith(caches.match(event.request).then(r => r || fetch(event.request)));
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl).catch(()=>{});
    }

    /* Initialize app */
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      document.getElementById('entregados').addEventListener('input', function() {
        const total = parseInt(document.getElementById('totalPaq').value) || 0;
        const entregados = parseInt(this.value) || 0;
        const noEntregados = Math.max(0, total - entregados);
        document.getElementById('noEntregados').value = noEntregados;
      });
      document.getElementById('totalPaq').addEventListener('input', function() {
        const total = parseInt(this.value) || 0;
        const entregados = parseInt(document.getElementById('entregados').value) || 0;
        const noEntregados = Math.max(0, total - entregados);
        document.getElementById('noEntregados').value = noEntregados;
      });
    });

    /* Prevent zoom on double tap */
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) event.preventDefault();
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>
